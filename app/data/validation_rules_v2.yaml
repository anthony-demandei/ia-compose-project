version: 2.0
title: "Advanced Validation Rules for Intelligent Intake System"
description: "Comprehensive validation rules covering business logic, compliance, quality, and technical constraints"
created_date: "2025-01-06"

# Advanced Validation Rules Configuration
validation_rules:
  # ============================================
  # BUSINESS LOGIC VALIDATION RULES
  # ============================================
  
  - rule_id: "HIGH_SCALE_AVAILABILITY_REQUIREMENT"
    name: "High Scale Systems High Availability Requirement"
    description: "Systems with high user load should have high availability requirements"
    category: "business_logic"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B009"
      if_values: ["50k_100k", "over_100k"]
      then_field: "N002"
      then_not_values: ["two_nines", "best_effort", "maintenance_ok"]
    parameters:
      min_availability: "99.9%"
      recommended_values: ["three_nines", "four_nines", "five_nines"]
    suggestions:
      - "Sistemas de alta escala requerem disponibilidade mínima de 99.9%"
      - "Considere implementar redundância e failover automático"
  
  - rule_id: "ECOMMERCE_PAYMENT_INTEGRATION"
    name: "E-commerce Payment Gateway Requirement"
    description: "E-commerce platforms should have payment processing capabilities"
    category: "business_logic"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "F001"
      if_values: ["ecommerce"]
      then_field: "B012"
      then_must_contain: "payment"
    suggestions:
      - "Plataformas de e-commerce geralmente precisam de gateway de pagamento"
      - "Considere integração com Stripe, PayPal ou similar"
  
  - rule_id: "HIGH_SCALE_MONITORING"
    name: "High Scale Systems Monitoring Requirement"
    description: "Systems with high user load need monitoring and observability"
    category: "business_logic"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B009"
      if_values: ["50k_100k", "over_100k"]
      then_must_mention: ["monitor", "observab", "metrics", "logs"]
    suggestions:
      - "Sistemas de alta escala precisam de monitoramento robusto"
      - "Implemente APM, logging centralizado e alertas"
  
  - rule_id: "ENTERPRISE_SECURITY_REQUIREMENTS"
    name: "Enterprise Systems Security Standards"
    description: "Enterprise systems need enhanced security measures"
    category: "business_logic"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B010"
      if_values: ["b2b", "enterprise", "internal"]
      then_field: "F003"
      then_must_contain_any: ["sso", "mfa", "certificate"]
    suggestions:
      - "Sistemas corporativos precisam de autenticação robusta"
      - "Implemente SSO e/ou autenticação multifator"
  
  - rule_id: "SAAS_MULTI_TENANCY_REQUIREMENT"
    name: "SaaS Multi-Tenancy Architecture Requirement"
    description: "SaaS applications should specify their multi-tenancy approach"
    category: "business_logic"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B010"
      if_values: ["saas"]
      then_field: "T003"
      then_not_values: ["not_applicable"]
    suggestions:
      - "Aplicações SaaS devem definir estratégia de multi-tenancy"
      - "Considere isolamento de dados e segurança entre tenants"
  
  - rule_id: "SAAS_BILLING_INTEGRATION"
    name: "SaaS Billing System Requirement"
    description: "SaaS applications typically need billing capabilities"
    category: "business_logic"
    severity: "info"
    enabled: true
    conditions:
      if_field: "B010"
      if_values: ["saas"]
      then_should_answer: "F020"
    suggestions:
      - "Aplicações SaaS geralmente precisam de sistema de billing"
      - "Considere assinaturas, cobrança por uso ou modelo freemium"
  
  - rule_id: "BAAS_COMPLIANCE_REQUIREMENT"
    name: "BaaS Regulatory Compliance Requirement" 
    description: "Banking as a Service requires financial compliance"
    category: "compliance"
    severity: "error"
    enabled: true
    conditions:
      or:
        - if_field: "T007"
          if_any_selected: true
        - if_field: "B003"
          if_values: ["finance"]
      then_field: "B008"
      then_must_contain_any: ["sox", "pci_dss", "lgpd"]
    suggestions:
      - "Serviços bancários requerem compliance rigoroso"
      - "SOX e PCI-DSS são obrigatórios para BaaS"

  # ============================================
  # COMPLIANCE VALIDATION RULES
  # ============================================
  
  - rule_id: "HEALTHCARE_HIPAA_COMPLIANCE"
    name: "Healthcare HIPAA Compliance Requirement"
    description: "Healthcare systems must comply with HIPAA regulations"
    category: "compliance"
    severity: "error"
    enabled: true
    conditions:
      if_field: "B003"
      if_values: ["healthcare"]
      then_field: "B008"
      then_must_contain: "hipaa"
    parameters:
      required_compliance: ["hipaa", "lgpd"]
    suggestions:
      - "Sistemas de saúde devem ter compliance HIPAA obrigatório"
      - "Implemente criptografia de dados e auditoria completa"
  
  - rule_id: "FINANCIAL_COMPLIANCE_REQUIREMENTS"
    name: "Financial Services Compliance"
    description: "Financial systems need SOX, PCI-DSS and data protection compliance"
    category: "compliance"
    severity: "error"
    enabled: true
    conditions:
      if_field: "B003"
      if_values: ["finance"]
      then_field: "B008"
      then_must_contain_any: ["sox", "pci_dss"]
    parameters:
      required_compliance: ["sox", "lgpd"]
      recommended_compliance: ["pci_dss", "iso27001"]
    suggestions:
      - "Sistemas financeiros precisam de compliance SOX obrigatório"
      - "Se processar pagamentos, PCI-DSS é obrigatório"
  
  - rule_id: "PAYMENT_PROCESSING_PCI_DSS"
    name: "Payment Processing PCI-DSS Requirement"
    description: "Systems processing payments must be PCI-DSS compliant"
    category: "compliance"
    severity: "error"
    enabled: true
    conditions:
      if_field: "B012"
      if_contains: "payment"
      then_field: "B008"
      then_must_contain: "pci_dss"
    suggestions:
      - "Processamento de pagamentos requer compliance PCI-DSS"
      - "Implemente tokenização e criptografia de dados de cartão"
  
  - rule_id: "EUROPEAN_MARKET_GDPR"
    name: "European Market GDPR Compliance"
    description: "Systems serving European market need GDPR compliance"
    category: "compliance"
    severity: "warning"
    enabled: true
    conditions:
      or:
        - if_field: "target_market"
          if_contains: ["europe", "eu", "european"]
        - if_field: "B003"
          if_values: ["multinational", "global"]
      then_field: "B008"
      then_should_contain: "lgpd"
    suggestions:
      - "Mercado europeu requer compliance GDPR/LGPD"
      - "Implemente consentimento de dados e direito ao esquecimento"

  # ============================================
  # DATA CONSISTENCY VALIDATION RULES
  # ============================================
  
  - rule_id: "BUDGET_TIMELINE_CONSISTENCY"
    name: "Budget and Timeline Consistency Check"
    description: "Budget and timeline should be realistic and consistent"
    category: "data_consistency"
    severity: "warning"
    enabled: true
    custom_logic: |
      def validate(answers):
          budget = answers.get("B004")
          timeline = answers.get("B005")
          
          if not budget or not timeline:
              return True
              
          high_budget = budget in ["1m_5m", "over_5m"]
          short_timeline = timeline in ["under_3m", "3_6m"]
          
          low_budget = budget in ["under_50k", "50k_200k"]
          long_timeline = timeline in ["18_24m", "over_24m"]
          
          return not ((high_budget and short_timeline) or (low_budget and long_timeline))
    suggestions:
      - "Orçamento e cronograma devem ser realistas e compatíveis"
      - "Projetos complexos precisam de mais tempo ou orçamento"
  
  - rule_id: "USER_LOAD_PERFORMANCE_CONSISTENCY"
    name: "User Load and Performance Requirements Consistency"
    description: "High user loads require appropriate performance specifications"
    category: "data_consistency"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B009"
      if_values: ["50k_100k", "over_100k"]
      then_field: "N001"
      then_not_values: ["best_effort", "batch_ok", "standard"]
    suggestions:
      - "Alto volume de usuários requer requisitos de performance rigorosos"
      - "Considere sub-second response time e processamento em tempo real"
  
  - rule_id: "INTEGRATION_COMPLEXITY_RESOURCES"
    name: "Integration Complexity vs Available Resources"
    description: "Multiple integrations need adequate resources and timeline"
    category: "data_consistency"
    severity: "info"
    enabled: true
    conditions:
      if_field: "B011"
      if_values: ["multiple"]
      and:
        - if_field: "B004"
          if_values: ["under_50k", "50k_200k"]
        - if_field: "B005"
          if_values: ["under_3m", "3_6m"]
    suggestions:
      - "Múltiplas integrações podem precisar de mais recursos e tempo"
      - "Considere implementação em fases ou aumento de orçamento"

  # ============================================
  # QUALITY ASSURANCE RULES
  # ============================================
  
  - rule_id: "INTAKE_TEXT_QUALITY"
    name: "Intake Text Quality Assessment"
    description: "Intake text should be descriptive and contain sufficient detail"
    category: "quality"
    severity: "warning"
    enabled: true
    parameters:
      min_length: 50
      recommended_length: 200
      required_keywords: ["sistema", "aplicação", "objetivo", "usuário"]
      bonus_keywords: ["integração", "performance", "segurança", "dados"]
    custom_logic: |
      def validate(intake_text):
          if not intake_text or len(intake_text) < 50:
              return False
          
          required_kw = ["sistema", "aplicação", "objetivo", "usuário"]
          found_required = sum(1 for kw in required_kw if kw in intake_text.lower())
          
          return found_required >= 2
    suggestions:
      - "Forneça mais detalhes sobre objetivos e funcionalidades"
      - "Mencione tecnologias ou restrições conhecidas"
      - "Descreva os usuários e casos de uso principais"
  
  - rule_id: "QUESTION_SELECTION_DIVERSITY"
    name: "Question Selection Diversity Check"
    description: "Selected questions should cover different stages and types"
    category: "quality"
    severity: "info"
    enabled: true
    parameters:
      min_stage_coverage: 3
      max_single_stage_percentage: 60
      min_question_types: 2
    suggestions:
      - "Garanta cobertura balanceada entre estágios de requisitos"
      - "Varie tipos de perguntas para melhor levantamento"
  
  - rule_id: "ANSWER_COMPLETENESS"
    name: "Answer Completeness and Quality"
    description: "Answers should be complete and meaningful"
    category: "quality"
    severity: "warning"
    enabled: true
    parameters:
      min_text_answer_length: 10
      require_all_multi_choice: false
      flag_generic_answers: true
      generic_patterns: ["não sei", "não definido", "qualquer", "tanto faz"]
    suggestions:
      - "Forneça respostas mais específicas e detalhadas"
      - "Evite respostas genéricas como 'não sei' ou 'qualquer'"

  # ============================================
  # COMPLETENESS VALIDATION RULES
  # ============================================
  
  - rule_id: "REQUIRED_QUESTIONS_COMPLETION"
    name: "Required Questions Must Be Answered"
    description: "All questions marked as required must have valid answers"
    category: "completeness"
    severity: "error"
    enabled: true
    parameters:
      strict_mode: true
      allow_skip_conditions: true
    suggestions:
      - "Complete todas as perguntas obrigatórias"
      - "Perguntas marcadas como 'required' são essenciais para o escopo"
  
  - rule_id: "STAGE_COVERAGE_COMPLETENESS"
    name: "Minimum Stage Coverage Requirement"
    description: "At least one question from each major stage should be covered"
    category: "completeness"
    severity: "warning"
    enabled: true
    parameters:
      required_stages: ["business", "functional", "technical", "nfr"]
      min_questions_per_stage: 1
      recommended_questions_per_stage: 2
    suggestions:
      - "Inclua pelo menos uma pergunta de cada estágio principal"
      - "Business, Functional, Technical e NFR são estágios essenciais"
  
  - rule_id: "CRITICAL_PATH_COMPLETION"
    name: "Critical Path Questions Completion"
    description: "Questions in the critical path for project success must be addressed"
    category: "completeness"
    severity: "error"
    enabled: true
    parameters:
      critical_question_ids: ["B001", "B003", "B004", "B005", "F001", "F002", "T001", "T002", "N001", "N002"]
      minimum_critical_answered: 8
    suggestions:
      - "Complete perguntas do caminho crítico para definição adequada do escopo"
      - "Estas perguntas são fundamentais para estimativas precisas"

  # ============================================
  # CONSTRAINT VALIDATION RULES
  # ============================================
  
  - rule_id: "QUESTION_LIMIT_CONSTRAINT"
    name: "Maximum Question Limit"
    description: "Total questions should not exceed usability limits"
    category: "constraint"
    severity: "warning"
    enabled: true
    parameters:
      max_questions: 15
      recommended_max: 12
      absolute_max: 20
    suggestions:
      - "Muitas perguntas podem prejudicar a experiência do usuário"
      - "Considere priorizar apenas as perguntas mais importantes"
  
  - rule_id: "TIME_CONSTRAINT_VALIDATION"
    name: "Session Time Constraint"
    description: "Intake session should not take too long to complete"
    category: "constraint"
    severity: "info"
    enabled: true
    parameters:
      max_session_time_minutes: 15
      recommended_time_minutes: 10
      time_per_question_seconds: 45
    suggestions:
      - "Sessões muito longas reduzem taxa de completude"
      - "Otimize número de perguntas para 10-12 minutos máximo"
  
  - rule_id: "COMPLEXITY_BUDGET_CONSTRAINT"
    name: "Project Complexity vs Budget Constraint"
    description: "Project complexity should align with available budget"
    category: "constraint"
    severity: "warning"
    enabled: true
    custom_logic: |
      def validate(answers):
          budget = answers.get("B004")
          
          # Calculate complexity score
          complexity_score = 0
          
          if answers.get("B011") == "multiple":  # Multiple systems
              complexity_score += 2
          
          if answers.get("B008") and len(answers.get("B008", [])) > 2:  # Many compliance
              complexity_score += 2
          
          if answers.get("B009") in ["50k_100k", "over_100k"]:  # High users
              complexity_score += 2
          
          if answers.get("N002") in ["five_nines", "four_nines"]:  # High availability
              complexity_score += 1
          
          if answers.get("F001") in ["enterprise", "data_platform"]:  # Complex apps
              complexity_score += 1
              
          # Check budget adequacy
          if budget in ["under_50k", "50k_200k"] and complexity_score >= 5:
              return False
          if budget in ["200k_500k"] and complexity_score >= 7:
              return False
              
          return True
    suggestions:
      - "Complexidade do projeto pode exceder orçamento disponível"
      - "Considere reduzir escopo ou aumentar orçamento"
      - "Implemente projeto em fases para distribuir custos"

  # ============================================
  # PERFORMANCE VALIDATION RULES
  # ============================================
  
  - rule_id: "SELECTION_ALGORITHM_PERFORMANCE"
    name: "Question Selection Algorithm Performance"
    description: "Question selection should complete within reasonable time"
    category: "performance"
    severity: "info"
    enabled: true
    parameters:
      max_selection_time_seconds: 5
      max_agent_consensus_time_seconds: 10
      cache_hit_ratio_threshold: 0.7
    suggestions:
      - "Otimize algoritmo de seleção para melhor performance"
      - "Considere usar cache para consultas similares"
  
  - rule_id: "DATABASE_PERFORMANCE_REQUIREMENTS"
    name: "Database Performance Requirements Validation"
    description: "Database requirements should match expected load"
    category: "performance"
    severity: "warning"
    enabled: true
    conditions:
      if_field: "B009"
      if_values: ["10k_50k", "50k_100k", "over_100k"]
      then_must_consider: ["indexing", "caching", "replication", "sharding"]
    suggestions:
      - "Alto volume de usuários requer otimizações de banco de dados"
      - "Considere indexação, cache e estratégias de escala"

# ============================================
# BUSINESS RULES CONFIGURATION
# ============================================

business_rules:
  industry_compliance_mapping:
    healthcare:
      required: ["hipaa", "lgpd"]
      recommended: ["iso27001", "sox"]
    finance:
      required: ["sox", "lgpd"]
      recommended: ["pci_dss", "iso27001"]
    ecommerce:
      required: ["lgpd"]
      recommended: ["pci_dss"]
    government:
      required: ["lgpd"]
      recommended: ["iso27001"]
    education:
      required: ["lgpd"]
      recommended: ["ferpa"]
  
  project_type_requirements:
    mission_critical:
      min_availability: "99.9%"
      required_monitoring: true
      required_backup: true
      required_security: ["mfa", "audit"]
    high_impact:
      min_availability: "99%"
      recommended_monitoring: true
      required_backup: true
    moderate:
      min_availability: "95%"
      recommended_backup: true
    low_impact:
      min_availability: "90%"
  
  scaling_thresholds:
    users:
      low: 1000
      medium: 10000
      high: 50000
      enterprise: 100000
    budget:
      startup: 50000
      small: 200000
      medium: 500000
      large: 1000000
      enterprise: 5000000

# ============================================
# VALIDATION SCORING CONFIGURATION
# ============================================

validation_scoring:
  severity_weights:
    critical: 0.4
    error: 0.15
    warning: 0.05
    info: 0.02
  
  category_importance:
    business_logic: 1.0
    compliance: 0.9
    data_consistency: 0.8
    completeness: 0.7
    quality: 0.6
    constraint: 0.5
    performance: 0.4
  
  quality_thresholds:
    excellent: 0.95
    good: 0.85
    acceptable: 0.70
    poor: 0.50
    unacceptable: 0.30

# ============================================
# SUGGESTION TEMPLATES
# ============================================

suggestion_templates:
  business_improvement:
    - "Considere alinhar melhor os requisitos técnicos com objetivos de negócio"
    - "Defina métricas de sucesso mensuráveis para o projeto"
    - "Identifique stakeholders principais e suas necessidades específicas"
  
  technical_improvement:
    - "Especifique requisitos técnicos com mais detalhes"
    - "Considere impactos de performance e escalabilidade"
    - "Defina arquitetura e tecnologias adequadas ao escopo"
  
  compliance_improvement:
    - "Revise requisitos de compliance para seu setor"
    - "Implemente controles de segurança adequados"
    - "Documente políticas de proteção de dados"
  
  quality_improvement:
    - "Forneça mais detalhes em suas respostas"
    - "Evite respostas genéricas ou incompletas"
    - "Considere casos de uso específicos e edge cases"

# ============================================
# VALIDATION METADATA
# ============================================

metadata:
  version: "2.0"
  last_updated: "2025-01-06"
  rule_count: 25
  categories_covered: 7
  compliance_frameworks: ["LGPD", "HIPAA", "SOX", "PCI-DSS", "ISO27001", "GDPR"]
  supported_languages: ["pt-BR"]
  validation_engine_compatibility: ">=2.0"